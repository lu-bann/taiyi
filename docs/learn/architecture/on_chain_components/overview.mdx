---
title: Overview
description: An overview of the dual AVS architecture in Taiyi
icon: 'map'
---
Taiyi implements two Active Validator Services (AVS) on EigenLayer:
1. Validator Service - Allows validators to opt-in and earn rewards from preconfirmations via delegation to operators from Preconf Service. 
2. Preconf Service - Enables opt-in operators to build preconfirmation blocks on behalf of opt-in validators from the Validator Service. 

<Note>
ValidatorAVS operator could opt-in to both services through self-delegation.
</Note>

Taiyi implements two distinct Active Validator Services (AVS) on EigenLayer:

1. **Validator AVS** – For Ethereum validators who interact with the Taiyi protocol passively, requiring only ETH client modifications (e.g. Commit-boost).
2. **Gateway AVS** – For operators who proactively issue, price, and include preconfirmation commitments, bearing the risk if those commitments fail to be included.

```mermaid
graph TB
        subgraph "Gateway AVS"
            GW[Gateway Operators]
            GW_LOGIC[Advanced Pricing & Preconf Logic]
            GW --> GW_LOGIC
            style GW fill:#ffe0b3,stroke:#ff9900
            style GW_LOGIC fill:#ffe0b3,stroke:#ff9900
        end
        
        subgraph "Validator AVS"
            VAL[Validators]
            VAL_LOGIC[Basic ETH Client + Commit-boost]
            VAL --> VAL_LOGIC
            style VAL fill:#ddffdd,stroke:#3f9c35
            style VAL_LOGIC fill:#ddffdd,stroke:#3f9c35
        end
        
        EL[EigenLayer Core]
        style EL fill:#a6c8ff,stroke:#0034e5
        
        GW --> EL
        VAL --> EL
```

## Why Dual AVS?

### Different Software Requirements
- **Validator AVS**: Minimal changes to existing ETH client with commit-boost integration
- **Gateway AVS**: Sophisticated setup with advanced pricing and preconfirmation logic

### Different Risk/Reward Profiles
| Aspect | Validator AVS | Gateway AVS |
|--------|--------------|-------------|
| Software Requirements | Minimal ETH client changes | Advanced pricing & preconf logic |
| System Approach | Passive restaking | Active participation with restaking security |
| Setup Complexity | Basic EL + CL + Commit-boost | Sophisticated Gateway + pricing strategy |
| Risk/Reward Profile | Lower risk/reward | Higher risk/reward |

## System Components

```mermaid
graph TB
    subgraph "Contract Architecture"
        TPR[TaiyiProposerRegistry]
        GAVS[GatewayAVS]
        VAVS[ValidatorAVS]
        ELM[EigenLayerMiddleware]
        
        TPR --> GAVS
        TPR --> VAVS
        GAVS --> ELM
        VAVS --> ELM
        
        style TPR fill:#ffffcc,stroke:#777700
        style GAVS fill:#ffe0b3,stroke:#ff9900
        style VAVS fill:#ddffdd,stroke:#3f9c35
        style ELM fill:#a6c8ff,stroke:#0034e5
    end
```

### Core Contracts
1. **[TaiyiProposerRegistry](./taiyi_proposer_registry)**: Registry contract managing validators and operators in both AVSs
2. **[EigenLayerMiddleware](./eigenlayer_middleware)**: Abstract contract that both AVSs inherit from
3. **GatewayAVS**: Contract handling gateway functionality and preconfirmation tasks
4. **ValidatorAVS**: Contract managing validator logic and basic staking operations

## Registration Flow

```mermaid
sequenceDiagram
    actor Operator
    participant DM as DelegationManager
    participant GAVS as GatewayAVS
    participant VAVS as ValidatorAVS
    participant TPR as TaiyiProposerRegistry
    
    Note over Operator,TPR: Step 1: EigenLayer Registration (Required for all paths)
    Operator->>DM: registerAsOperator()
        
    Note over Operator,TPR: Option A: Validator AVS Only
    rect rgb(221, 255, 221)
        Operator->>VAVS: registerOperatorToAVS()
        Note over VAVS: Provides operator signature
        VAVS->>TPR: Register as Validator
        Note over TPR: ✓ Can now receive validator rewards
    end
    
    Note over Operator,TPR: Option B: Gateway AVS Only
    rect rgb(255, 224, 179)
        Operator->>GAVS: registerOperatorToAVSWithPubKey()
        Note over GAVS: Provides BLS key + signature
        GAVS->>TPR: Register as Gateway
        Note over TPR: ✓ Can now handle preconfirmations
    end
    
    Note over Operator,TPR: Option C: Both AVSs (Self-Delegation)
    rect rgb(255, 242, 230)
        Operator->>GAVS: 1. registerOperatorToAVSWithPubKey()
        GAVS->>TPR: Register as Gateway
        Operator->>VAVS: 2. registerOperatorToAVS()
        Note over VAVS: Self-delegates to own Gateway
        VAVS->>TPR: Register as Validator
        Note over TPR: ✓ Maximum participation & rewards
    end
```

## Reward Distribution
The dual AVS implements a collaborative approach to block proposals with shared tips and fees between AVSs:

```mermaid
graph TD
    RI[Reward Initiator] --> GAVS[GatewayAVS]
    GAVS --> |Gateway Portion|GO[Gateway Operators]
    GAVS --> |Validator Portion|VAVS[ValidatorAVS]
    VAVS --> |Distributed by Validator Count|VO[Validator Operators]
    
    style RI fill:#f9f,stroke:#333
    style GAVS fill:#ffe0b3,stroke:#ff9900
    style VAVS fill:#ddffdd,stroke:#3f9c35
    style GO fill:#ffe0b3,stroke:#ff9900
    style VO fill:#ddffdd,stroke:#3f9c35
```

<Note>
 Example Reward Flow
Consider a reward distribution of 1000 tokens:

1. GatewayAVS receives two submissions:
   - "Gateway" portion (1000 tokens)
   - "Validator" placeholder

2. GatewayAVS splits the tokens:
   - 70% (700 tokens) distributed among 5 Gateway operators
   - 30% (300 tokens) reserved for ValidatorAVS

3. ValidatorAVS distributes 300 tokens among 3 operators based on validator count:
   - Operator1 (50 validators): 150 tokens
   - Operator2 (30 validators): 90 tokens  
   - Operator3 (20 validators): 60 tokens

4. Operators claim their shares from RewardsCoordinator
</Note>

